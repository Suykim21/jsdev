<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>AsyncAwait</title>
</head>
<body>
  
  <script>
    // Promise - something that will happen between now and end of time (analogy)

    // const postsPromise = fetch("https://jsonplaceholder.typicode.com/posts");
    // // json() - converts raw data to json format (returns promise)
    // postsPromise
    //   .then(data => data.json())
    //   .then(data => console.log(data))
    //   .catch(err => console.log(err));

    // Creating promise
    // const p = new Promise((resolve, reject) => {
    //   setTimeout(() => {
    //     //resolve('steve')
    //     reject(Error('Err west isn\'t cool'));
    //   }, 1000);
    // });

    // p
    //   .then(data => console.log(data))
    //   .catch(err => console.error(err));

    // Flow control
    // const posts = [
    //   { title: 'I love JavaScript', author: 'vivian', id: 1},
    //   { title: 'CSS', author: 'chris', id: 2},
    //   { title: 'Devtools', author: 'travis', id: 3}
    // ];

    // const authors = [
    //   { name: 'vivian', twitter: '@vivian', bio: "design"},
    //   { name: 'chris', twitter: '@chris', bio: "frontend"},
    //   { name: 'travis', twitter: '@travis', bio: "backend"}
    // ];

    // function getPostById(id) {
    //   // //Create promise
    //   return new Promise((resolve, reject) => {
    //     ////using a settimeout to mimick database
    //     setTimeout(() => {
    //       ////find the post we want
    //       const post = posts.find(post => post.id === id);

    //       if(post) {
    //       resolve(post); // send the post back
    //       } else {
    //         reject(Error('No post was found'));
    //       }
    //     }, 200);
    //   });
    // }

    // function hydrateAuthor(post) {
    //   // Create a promise
    //   return new Promise((resolve, reject) => {
    //     // find the author
    //     const authorDetails = authors.find(person => person.name === post.author);
    //     if(authorDetails) {
    //       // hydrate post obj with author obj
    //       post.author = authorDetails;
    //       resolve(post);
    //     } else {
    //       reject(Error('Cannot find the author'));
    //     }
    //   });
    // }

    // getPostById(2)
    //   .then(post => {
    //     console.log(post);
    //     return hydrateAuthor(post);
    //   })
    //   .then(post => {
    //     console.log(post);
    //   })
    //   .catch(err => console.error(err));

    // Working with multiple promises
    // const weather = new Promise((resolve) => {
    //   setTimeout(() => {
    //     resolve({temp: 29, conditions: 'Sunny with Clouds'});
    //   }, 2000);
    // });

    // const tweets = new Promise((resolve) => {
    //   setTimeout(() => {
    //     resolve(['I like cake', 'i love bbq']);
    //   }, 500);
    // });

    // // Waiting for all promises to resolve at once
    // Promise.all([weather, tweets])
    //   .then(responses => {
    //     const [weatherInfo, tweetsInfo] = responses;
    //   })

    const postsPromise = fetch('https://jsonplaceholder.typicode.com/posts');
    const commentsPromise = fetch('https://jsonplaceholder.typicode.com/comments');

    Promise.all([postsPromise, commentsPromise])
      .then(responses => {
        // map - creates new array
        return Promise.all(responses.map(res => res.json()))
      })
      .then(responses => {
        console.log(responses);
      });
  </script>
</body>
</html>